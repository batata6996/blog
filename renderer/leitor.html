<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Leitura detalhada de um post.">
  <title>Leitura de Post | Meu Blog</title>
  <style>
    /* Reset b√°sico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f7f9f9;
      color: #0f1419;
      min-height: 100vh;
      position: relative;
    }

    header {
      background-color: #1da1f2;
      color: white;
      padding: 10px 20px;
      height: 60px;
      width: 100%;
      position: fixed;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
    }

    header h1 {
      font-size: 1.8rem;
      margin-left: 10px;
    }

    header .logo {
      height: 50px;
      width: auto;
      vertical-align: middle;
    }

    header nav {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
    }

    header nav ul {
      display: flex;
      list-style: none;
    }

    header nav ul li {
      margin-left: 15px;
    }

    header nav ul li a {
      color: white;
      text-decoration: none;
      font-size: 1rem;
      font-weight: bold;
      transition: color 0.3s;
    }

    header nav ul li a:hover {
      color: #d8eefe;
    }

    .container {
      display: flex;
      margin-top: 80px; /* Espa√ßo para o header */
    }

    aside.sidebar {
      position: fixed;
      top: 60px;
      left: 0;
      width: 13%;
      height: calc(100vh - 60px); /* Altura ajustada ao header */
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #e1e8ed;
      padding: 20px;
      overflow-y: auto;
    }

    aside.sidebar h3 {
      margin-bottom: 10px;
      font-size: 1.2rem;
      color: #1da1f2;
    }

    aside.sidebar ul {
      list-style: none;
      padding: 0;
    }

    aside.sidebar ul li {
      margin-bottom: 10px;
    }

    aside.sidebar ul li a {
      display: flex;
      align-items: center;
      padding: 10px;
      border-radius: 8px;
      color: #0f1419;
      text-decoration: none;
      font-size: 1rem;
      font-weight: bold;
      transition: background-color 0.3s, color 0.3s;
    }

    aside.sidebar ul li a:hover {
      background-color: #f1f1f1;
      color: #1da1f2;
    }

    main {
      margin-left: 15%;
      width: 70%;
      padding: 20px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e1e8ed;
    }

    main h1 {
      font-size: 2rem;
      color: #1da1f2;
      margin-bottom: 10px;
    }

    main .metadata {
      font-size: 0.9rem;
      color: #657786;
      margin-bottom: 20px;
    }

    main article {
      font-size: 1rem;
      line-height: 1.6;
      color: #0f1419;
    }

    main article p {
      margin-bottom: 20px;
    }

    footer {
      background-color: #e1e8ed;
      color: #657786;
      text-align: center;
      padding: 15px 0;
      position: fixed;
      bottom: 0;
      width: 100%;
    }

    #likeButton {
      font-size: 1rem;
      color: white;
      background-color: #1da1f2;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: inline-block;
      margin-top: 20px;
    }

    #likeButton:hover {
      background-color: #0d8de1;
    }

    .comments {
      margin-top: 30px;
    }

    .comments h2 {
      margin-bottom: 10px;
      color: #1da1f2;
    }

    .comments ul {
      list-style: none;
      padding: 0;
      margin-bottom: 20px;
    }

    .comments ul li {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .comments form {
      display: flex;
      flex-direction: column;
    }

    .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }

  .modal-content {
    background: transparent;
    width: 20%;
    height: 52%;
    border-radius: 12px;
    position: relative;
  }

    .comments textarea {
      resize: none;
      padding: 10px;
      border: 1px solid #e1e8ed;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .comments button {
      align-self: flex-end;
      background-color: #1da1f2;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .comments button:hover {
      background-color: #0d8de1;
    }
  </style>
</head>
<body>
  <header>
    <img src="Designer-removebg-preview.png" alt="Logo do site" class="logo">
    <h1>C√≥digo em Paralelo</h1>
    <nav>
      <ul>
        <li><a href="dashboard.html">Home</a></li>
        <li><a id="admin-button" href="escrita.html" style="display: none;">Escrever Post</a></li>
        <li><a id="login-button" href="login.html">Login</a></li>
        <li><a id="logout-button" href="#">Logout</a></li>
      </ul>
    </nav>
  </header>

  <div id="login-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <iframe src="login.html" frameborder="0" class="modal-iframe" style="width: 100%; height: 100%;"></iframe>
    </div>
  </div>

  <div class="container">
    <aside class="sidebar">
      <h3>Menu</h3>
      <ul>
        <li><a href="#">In√≠cio</a></li>
        <li><a href="#">Explorar</a></li>
        <li><a href="#">Inscri√ß√µes</a></li>
        <li><a href="#">Biblioteca</a></li>
      </ul>
    </aside>

    <main>
      <h1>T√≠tulo do Post</h1>
      <p class="metadata">Publicado por <strong>Autor</strong> em <em>30 de Novembro de 2024</em></p>
      <article>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla facilisi. Donec eu justo sit amet sapien tempor luctus. Sed ac nisl et justo facilisis suscipit. Mauris malesuada ex at tristique scelerisque.</p>
        <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
        <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      </article>

      <!-- Bot√£o Curtir -->
      <button id="likeButton" onclick="toggleLike()">‚ù§Ô∏è Curtir (<span id="likeCount">0</span>)</button>

      <!-- Se√ß√£o de Coment√°rios -->
      <section class="comments">
        <h2>Coment√°rios</h2>
        <ul id="commentList">
          <!-- Coment√°rios din√¢micos aparecem aqui -->
        </ul>
        <form id="commentForm" onsubmit="addComment(event)">
          <textarea id="commentInput" placeholder="Deixe seu coment√°rio" required></textarea>
          <button type="submit">Enviar</button>
        </form>
      </section>
    </main>
  </div>

  <footer>
    <p>&copy; 2024 Blog. Todos os direitos reservados.</p>
  </footer>

  <script>
    let likeCount = 0;

    document.addEventListener('DOMContentLoaded', function () {
      const loginButton = document.getElementById('login-button');
      const logoutButton = document.getElementById('logout-button');
      const adminButton = document.getElementById('admin-button'); 
      const modal = document.getElementById('login-modal');

      function parseJwt(token) {
        try {
          return JSON.parse(atob(token.split('.')[1]));
        } catch (e) {
          console.error('Erro ao decodificar JWT:', e);
          return null;
        }
      }

      function checkLoginStatus() {
        const authToken = localStorage.getItem('authToken');
        if (authToken) {
          const decodedToken = parseJwt(authToken);
          if (decodedToken && decodedToken.isAdmin) {
            adminButton.style.display = 'inline'; // Mostra o bot√£o admin
          } else {
            adminButton.style.display = 'none'; // Oculta o bot√£o admin se n√£o for isAdmin
          }
          loginButton.style.display = 'none';
          logoutButton.style.display = 'inline';
        } else {
          adminButton.style.display = 'none'; // Oculta o bot√£o admin
          loginButton.style.display = 'inline';
          logoutButton.style.display = 'none';
        }
      }


      loginButton.addEventListener('click', function (event) {
        event.preventDefault();
        modal.style.display = 'flex'; 
      });
  
      window.addEventListener('click', function (event) {
        if (event.target === modal) {
          modal.style.display = 'none'; 
        }
      });
  
      window.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'loginSuccess') {
          modal.style.display = 'none'; 
          checkLoginStatus(); 
        }
      });
  
      logoutButton.addEventListener('click', function (event) {
        event.preventDefault();
        localStorage.removeItem('authToken'); 
        checkLoginStatus(); 
      });
       
      checkLoginStatus();
    });

    function toggleLike() {
      const likeButton = document.getElementById('likeButton');
      const likeCountSpan = document.getElementById('likeCount');

      if (likeButton.classList.contains('liked')) {
        likeCount--;
        likeButton.classList.remove('liked');
        likeButton.textContent = `‚ù§Ô∏è Curtir (${likeCount})`;
      } else {
        likeCount++;
        likeButton.classList.add('liked');
        likeButton.textContent = `üíî Descurtir (${likeCount})`;
      }

      likeCountSpan.textContent = likeCount;
    }

    function addComment(event) {
      event.preventDefault();
      const commentInput = document.getElementById('commentInput');
      const commentList = document.getElementById('commentList');

      if (commentInput.value.trim() !== '') {
        const newComment = document.createElement('li');
        newComment.textContent = commentInput.value;
        commentList.appendChild(newComment);
        commentInput.value = '';
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get('id');

      if (!postId) {
        document.querySelector('main').innerHTML = '<p>Post n√£o encontrado.</p>';
        return;
      }

      try {
        const response = await fetch(`http://localhost:3000/api/posts/${postId}`);
        if (!response.ok) throw new Error('Erro ao buscar o post');
        
        const post = (await response.json())[0]; // Ajustado para acessar o primeiro item do array
        if (!post) {
          document.querySelector('main').innerHTML = '<p>Post n√£o encontrado.</p>';
          return;
        }

        // Manipula√ß√£o do DOM com valida√ß√µes
        const titleElement = document.querySelector('main h1');
        const metadataElement = document.querySelector('.metadata');
        const articleElement = document.querySelector('article');

        if (titleElement) titleElement.textContent = post.Title;
        if (metadataElement) {
          metadataElement.innerHTML = `Publicado por <strong>${post.Author}</strong> em <em>${new Date(post.CreatedAt).toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: 'long',
            year: 'numeric',
          })}</em>`;
          console.log("Resultado da consulta:", post);

        }
        if (articleElement) {
          articleElement.innerHTML = post.Content 
            ? `<p>${post.Content.replace(/\n/g, '</p><p>')}</p>` 
            : '<p>Conte√∫do n√£o dispon√≠vel.</p>';
        }

      } catch (error) {
        console.error('Erro:', error);
        document.querySelector('main').innerHTML = '<p>Erro ao carregar o post.</p>';
      }
    });

  </script>
</body>
</html>
